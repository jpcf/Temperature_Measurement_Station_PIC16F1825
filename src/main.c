#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>
#include <xc.h>
#include "../include/PIC16F1825_configs.h"
#include "../include/ds18b20.h"
#include "../include/lib_LCD_Nokia5110.h"
#include "../include/lib_memtest_PIC16F1825.h"

const char IMG[504] = {
0x08,
0xA2,
0x55,
0x08,
0x22,
0x04,
0x29,
0x02,
0x28,
0x12,
0x05,
0x28,
0x02,
0x14,
0x09,
0x22,
0x14,
0x00,
0x00,
0x22,
0x88,
0x55,
0x22,
0x08,
0x22,
0x09,
0x14,
0x22,
0x08,
0x05,
0x12,
0x28,
0x02,
0x29,
0x04,
0x12,
0x00,
0x00,
0xA2,
0x08,
0xA5,
0x48,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x22,
0x88,
0x25,
0x48,
0x00,
0x00,
0x00,
0x00,
0x00,
0xA2,
0x08,
0x65,
0x88,
0x12,
0x24,
0x09,
0x22,
0x08,
0x12,
0x29,
0x04,
0x10,
0x4A,
0x90,
0x40,
0x90,
0x00,
0x02,
0x68,
0x05,
0x52,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x42,
0x98,
0x22,
0x49,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x90,
0x26,
0x48,
0x12,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x14,
0x41,
0xAC,
0x11,
0x00,
0x00,
0x00,
0x00,
0x00,
0x48,
0x12,
0xC5,
0x10,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x02,
0x88,
0x22,
0x54,
0x89,
0x20,
0x8B,
0x54,
0x21,
0x80,
0x20,
0x40,
0x80,
0x20,
0x40,
0x00,
0x40,
0xA0,
0x00,
0x40,
0x00,
0x00,
0x00,
0x00,
0xA2,
0x08,
0x65,
0x08,
0xA0,
0x40,
0x00,
0xA0,
0x40,
0x00,
0x20,
0x40,
0x80,
0x20,
0x80,
0x00,
0x00,
0x00,
0x00,
0x28,
0x82,
0x59,
0x22,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x51,
0x04,
0xB2,
0x44,
0x00,
0x00,
0x00,
0x00,
0x00,
0x91,
0x24,
0x4A,
0x11,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x80,
0x20,
0x48,
0x12,
0xA5,
0x08,
0x88,
0x22,
0x95,
0x20,
0x04,
0x01,
0x02,
0x00,
0x02,
0x05,
0x00,
0x01,
0x02,
0x04,
0x01,
0x00,
0x00,
0x00,
0x00,
0x48,
0x12,
0xA5,
0x08,
0x02,
0x04,
0x01,
0x04,
0x02,
0x01,
0x04,
0x01,
0x02,
0x00,
0x02,
0x00,
0x00,
0x00,
0x00,
0x52,
0x84,
0x29,
0x42,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x24,
0x89,
0x52,
0x84,
0x00,
0x00,
0x00,
0x00,
0x00,
0x14,
0x41,
0xAC,
0x11,
0x04,
0x2A,
0x00,
0x14,
0x22,
0x08,
0x14,
0x21,
0x0A,
0x04,
0x01,
0x02,
0x00,
0x00,
0x08,
0x52,
0xA4,
0x09,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0xA4,
0x09,
0xA4,
0x49,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x0A,
0x40,
0x15,
0xA2,
0x48,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x40,
0x0A,
0x50,
0xA6,
0x08,
0x00,
0x00,
0x00,
0x00,
0x00,
0x49,
0x12,
0xC4,
0x11,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x04,
0x51,
0x2A,
0x04,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x2A,
0x00,
0x2A,
0x14,
0x40,
0x08,
0x50,
0x20,
0x08,
0x10,
0x20,
0x48,
0x10,
0x40,
0x28,
0x10,
0x40,
0x00,
0x00,
0x00,
0x00,
0x05,
0x10,
0x02,
0x15,
0x20,
0x54,
0x00,
0x28,
0x10,
0x40,
0x08,
0x50,
0x20,
0x08,
0x54,
0x21,
0x0C,
0x21,
0x0A,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x45,
0x10,
0x2A,
0x41,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00,
0x00};


int main(int argc, char** argv) {
    
    char tempStr[14];
    LCDcursor cursor;    
    // ----- Device Initial Config ----- //
    pic16f1825_init();
    
    // ------ LCD Initial Config ------- //
    initLCD();
    configLCD();
    
    // ---------- RAM Testing ---------- //
    uint16_t RAMtest = memtest_MARCH_Cmin();
    LATC1 = 1;
    
    clearLCD(&cursor);
    sprintf(tempStr, "Memory Tests:");  
    printlnLCD(tempStr, strlen(tempStr), 2, &cursor);
    
    // Returns 0x3000 if no Errors, otherwise returns the address of the first error
    gotoXY(0, cursor.yPos+1);
    cursor.yPos += 1;
    
    if(0x3000 == RAMtest){
        sprintf(tempStr, "RAM Test OK!");  
        printlnLCD(tempStr, strlen(tempStr), 2, &cursor);
    }else {
        sprintf(tempStr, "!RAM @ 0x%04X", RAMtest);
        printlnLCD(tempStr, strlen(tempStr), 2, &cursor);
    }

    // ---------- ROM Testing ---------- //
    uint8_t ROMtest = memtest_program_mem();
    if(0 == ROMtest){
        sprintf(tempStr, "ROM Test OK!");  
        printlnLCD(tempStr, strlen(tempStr), 2, &cursor); 
    }else {
        sprintf(tempStr, "ROM Error!");  
        printlnLCD(tempStr, strlen(tempStr), 2, &cursor);
    }
    
    __delay_ms(3000);
    printImageLCD(IMG);
    //set_precision_ds18b20(PRECISION_12);
    
    
    while(1){
        //start_temp_measure_ds18b20();
        //__delay_ms(1000);           // Wait for temperature measurement 
        //tempe = read_temp_ds18b20();
        
        // IMPRIMIR NO LCD O VALOR DA TEMPERATURA
  
    }

    return (EXIT_SUCCESS);
}

